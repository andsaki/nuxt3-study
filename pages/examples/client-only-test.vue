<script setup lang="ts">
const timestamp = new Date().toISOString()
</script>

<template>
  <div class="container">
    <h1>ClientOnly å‹•ä½œç¢ºèª</h1>

    <div class="instruction">
      <h2>ğŸ” ç¢ºèªæ–¹æ³•</h2>
      <ol>
        <li>ã“ã®ãƒšãƒ¼ã‚¸ã§å³ã‚¯ãƒªãƒƒã‚¯ â†’ ã€Œãƒšãƒ¼ã‚¸ã®ã‚½ãƒ¼ã‚¹ã‚’è¡¨ç¤ºã€</li>
        <li>HTMLã‚½ãƒ¼ã‚¹ã«ä½•ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª</li>
        <li>DevToolsï¼ˆF12ï¼‰ã§å®Ÿéš›ã®DOMã‚’ç¢ºèª</li>
        <li>é•ã„ã‚’æ¯”è¼ƒ</li>
      </ol>
    </div>

    <div class="example-section">
      <h2>ä¾‹1: fallbackã‚ã‚Š</h2>
      <div class="demo-box">
        <ClientOnly>
          <div class="client-content">
            <p><strong>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®å†…å®¹</strong></p>
            <p>ã“ã®å†…å®¹ã¯<code>HTMLã‚½ãƒ¼ã‚¹</code>ã«ã¯å«ã¾ã‚Œã¾ã›ã‚“</p>
            <p>DevToolsã§ã®ã¿è¦‹ãˆã¾ã™</p>
          </div>
          <template #fallback>
            <div class="server-content">
              <p><strong>ã‚µãƒ¼ãƒãƒ¼å´ã®å†…å®¹ï¼ˆfallbackï¼‰</strong></p>
              <p>ã“ã®å†…å®¹ã¯<code>HTMLã‚½ãƒ¼ã‚¹</code>ã«å«ã¾ã‚Œã¾ã™</p>
              <p>Hydrationå¾Œã«ä¸Šã®å†…å®¹ã«åˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™</p>
            </div>
          </template>
        </ClientOnly>
      </div>
    </div>

    <div class="example-section">
      <h2>ä¾‹2: fallbackãªã—</h2>
      <div class="demo-box">
        <ClientOnly>
          <div class="client-content">
            <p><strong>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ã¿</strong></p>
            <p>HTMLã‚½ãƒ¼ã‚¹ã«ã¯ä½•ã‚‚å‡ºåŠ›ã•ã‚Œã¾ã›ã‚“</p>
            <p>ç©ºã®ã‚³ãƒ¡ãƒ³ãƒˆãƒãƒ¼ãƒ‰ã ã‘ãŒå‡ºåŠ›ã•ã‚Œã¾ã™</p>
          </div>
        </ClientOnly>
      </div>
    </div>

    <div class="example-section">
      <h2>ä¾‹3: é€šå¸¸ã®SSRï¼ˆæ¯”è¼ƒç”¨ï¼‰</h2>
      <div class="demo-box">
        <div class="ssr-content">
          <p><strong>é€šå¸¸ã®SSRã‚³ãƒ³ãƒ†ãƒ³ãƒ„</strong></p>
          <p>ã“ã®å†…å®¹ã¯<code>HTMLã‚½ãƒ¼ã‚¹</code>ã«å«ã¾ã‚Œã¾ã™</p>
          <p>ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—: {{ timestamp }}</p>
        </div>
      </div>
    </div>

    <div class="html-source">
      <h2>ğŸ“„ HTMLã‚½ãƒ¼ã‚¹ã«å«ã¾ã‚Œã‚‹ã‚‚ã®</h2>
      <table>
        <thead>
          <tr>
            <th>ã‚±ãƒ¼ã‚¹</th>
            <th>HTMLã‚½ãƒ¼ã‚¹</th>
            <th>DevToolsï¼ˆDOMï¼‰</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>fallbackã‚ã‚Š</td>
            <td>âœ… fallbackã®å†…å®¹</td>
            <td>âœ… ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¹ãƒ­ãƒƒãƒˆ</td>
          </tr>
          <tr>
            <td>fallbackãªã—</td>
            <td>âŒ ã‚³ãƒ¡ãƒ³ãƒˆãƒãƒ¼ãƒ‰ã®ã¿</td>
            <td>âœ… ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¹ãƒ­ãƒƒãƒˆ</td>
          </tr>
          <tr>
            <td>é€šå¸¸ã®SSR</td>
            <td>âœ… å…¨å†…å®¹</td>
            <td>âœ… å…¨å†…å®¹</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="lifecycle">
      <h2>â±ï¸ ClientOnlyã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«</h2>
      <div class="timeline">
        <div class="step">
          <div class="step-number">1</div>
          <div class="step-content">
            <h3>ã‚µãƒ¼ãƒãƒ¼å´ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°</h3>
            <p><code>#fallback</code>ã‚’HTMLã¨ã—ã¦å‡ºåŠ›</p>
            <code>&lt;p&gt;ã‚µãƒ¼ãƒãƒ¼å´ã®å†…å®¹&lt;/p&gt;</code>
          </div>
        </div>
        <div class="arrow">â†“</div>
        <div class="step">
          <div class="step-number">2</div>
          <div class="step-content">
            <h3>ãƒ–ãƒ©ã‚¦ã‚¶ã§HTMLå—ä¿¡</h3>
            <p>fallbackã®å†…å®¹ãŒè¡¨ç¤ºã•ã‚Œã‚‹</p>
            <code>&lt;p&gt;ã‚µãƒ¼ãƒãƒ¼å´ã®å†…å®¹&lt;/p&gt;</code>
          </div>
        </div>
        <div class="arrow">â†“</div>
        <div class="step">
          <div class="step-number">3</div>
          <div class="step-content">
            <h3>Hydrationï¼ˆãƒãƒƒãƒãƒ³ã‚°ï¼‰</h3>
            <p>fallbackã¨ã‚µãƒ¼ãƒãƒ¼HTMLãŒä¸€è‡´ âœ…</p>
            <code>&lt;p&gt;ã‚µãƒ¼ãƒãƒ¼å´ã®å†…å®¹&lt;/p&gt;</code>
          </div>
        </div>
        <div class="arrow">â†“</div>
        <div class="step">
          <div class="step-number">4</div>
          <div class="step-content">
            <h3>onMountedå¾Œ</h3>
            <p>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¹ãƒ­ãƒƒãƒˆã«åˆ‡ã‚Šæ›¿ãˆ</p>
            <code>&lt;p&gt;ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®å†…å®¹&lt;/p&gt;</code>
          </div>
        </div>
      </div>
    </div>

    <div class="code-example">
      <h2>ğŸ’» å®Ÿè£…</h2>
      <pre><code>&lt;ClientOnly&gt;
  &lt;!-- ã“ã®éƒ¨åˆ†ã¯HTMLã‚½ãƒ¼ã‚¹ã«å«ã¾ã‚Œãªã„ --&gt;
  &lt;p&gt;ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®å†…å®¹&lt;/p&gt;

  &lt;!-- ã“ã®éƒ¨åˆ†ãŒHTMLã‚½ãƒ¼ã‚¹ã«å«ã¾ã‚Œã‚‹ --&gt;
  &lt;template #fallback&gt;
    &lt;p&gt;ã‚µãƒ¼ãƒãƒ¼å´ã®å†…å®¹&lt;/p&gt;
  &lt;/template&gt;
&lt;/ClientOnly&gt;</code></pre>
    </div>

    <div class="hydration-section">
      <h2>âš ï¸ Hydrationã‚¨ãƒ©ãƒ¼ãŒèµ·ãã‚‹ã‚±ãƒ¼ã‚¹ãƒ»èµ·ããªã„ã‚±ãƒ¼ã‚¹</h2>

      <div class="case-grid">
        <div class="case-card safe">
          <h3>âœ… ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãªã„ï¼ˆå®‰å…¨ï¼‰</h3>
          <pre v-pre><code>&lt;script setup&gt;
const isClient = ref(false)
onMounted(() => {
  isClient.value = true
})
&lt;/script&gt;

&lt;template&gt;
  &lt;!-- åˆæœŸå€¤ãŒä¸€è‡´ã™ã‚‹ã®ã§OK --&gt;
  &lt;p&gt;{{ isClient ? "ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ" : "ã‚µãƒ¼ãƒãƒ¼" }}&lt;/p&gt;
&lt;/template&gt;</code></pre>
          <p class="explanation">
            <strong>ç†ç”±:</strong> ã‚µãƒ¼ãƒãƒ¼ã‚‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚‚åˆæœŸå€¤ã¯<code>false</code>ãªã®ã§ä¸€è‡´ã™ã‚‹
          </p>
        </div>

        <div class="case-card danger">
          <h3>âŒ ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ï¼ˆå±é™ºï¼‰</h3>
          <pre v-pre><code>&lt;template&gt;
  &lt;!-- ã‚µãƒ¼ãƒãƒ¼ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§å€¤ãŒé•ã† --&gt;
  &lt;p&gt;{{ new Date().toISOString() }}&lt;/p&gt;

  &lt;!-- æ¯å›é•ã†å€¤ --&gt;
  &lt;p&gt;{{ Math.random() }}&lt;/p&gt;

  &lt;!-- ç’°å¢ƒã§æœ€åˆã‹ã‚‰å€¤ãŒç•°ãªã‚‹ --&gt;
  &lt;p&gt;{{ import.meta.client ? "ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ" : "ã‚µãƒ¼ãƒãƒ¼" }}&lt;/p&gt;
&lt;/template&gt;</code></pre>
          <p class="explanation">
            <strong>ç†ç”±:</strong> ã‚µãƒ¼ãƒãƒ¼ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§Hydrationæ™‚ã®å€¤ãŒç•°ãªã‚‹
          </p>
        </div>
      </div>

      <div class="comparison-box">
        <h3>ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ¥æ¯”è¼ƒ</h3>
        <table>
          <thead>
            <tr>
              <th>ãƒ‘ã‚¿ãƒ¼ãƒ³</th>
              <th>ã‚µãƒ¼ãƒãƒ¼</th>
              <th>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆHydrationï¼‰</th>
              <th>çµæœ</th>
            </tr>
          </thead>
          <tbody>
            <tr class="safe-row">
              <td><code>ref(false)</code> + ä¸‰é …æ¼”ç®—å­</td>
              <td>"ã‚µãƒ¼ãƒãƒ¼"</td>
              <td>"ã‚µãƒ¼ãƒãƒ¼"</td>
              <td>âœ… ä¸€è‡´</td>
            </tr>
            <tr class="safe-row">
              <td><code>ref(false)</code> + v-if</td>
              <td>elseãƒ–ãƒ­ãƒƒã‚¯è¡¨ç¤º</td>
              <td>elseãƒ–ãƒ­ãƒƒã‚¯è¡¨ç¤º</td>
              <td>âœ… ä¸€è‡´</td>
            </tr>
            <tr class="safe-row">
              <td><code>ClientOnly</code></td>
              <td>fallbackè¡¨ç¤º</td>
              <td>fallbackè¡¨ç¤º</td>
              <td>âœ… ä¸€è‡´ï¼ˆç‰¹åˆ¥æ‰±ã„ï¼‰</td>
            </tr>
            <tr class="danger-row">
              <td><code>new Date()</code></td>
              <td>2024-01-01T10:00:00</td>
              <td>2024-01-01T10:00:01</td>
              <td>âŒ ä¸ä¸€è‡´</td>
            </tr>
            <tr class="danger-row">
              <td><code>import.meta.client</code></td>
              <td>false</td>
              <td>true</td>
              <td>âŒ ä¸ä¸€è‡´</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="vif-section">
      <h2>ğŸ”€ v-if vs ä¸‰é …æ¼”ç®—å­ vs ClientOnly</h2>

      <div class="method-grid">
        <div class="method-card">
          <h3>ä¸‰é …æ¼”ç®—å­</h3>
          <pre v-pre><code>&lt;p&gt;{{ isClient ? "A" : "B" }}&lt;/p&gt;</code></pre>
          <ul>
            <li>DOMæ§‹é€ ã¯ä¸å¤‰</li>
            <li>ãƒ†ã‚­ã‚¹ãƒˆãƒãƒ¼ãƒ‰ã®ã¿å¤‰æ›´</li>
            <li>è»½é‡</li>
          </ul>
        </div>

        <div class="method-card">
          <h3>v-if / v-else</h3>
          <pre v-pre><code>&lt;p v-if="isClient"&gt;A&lt;/p&gt;
&lt;p v-else&gt;B&lt;/p&gt;</code></pre>
          <ul>
            <li>è¦ç´ ã®å‰Šé™¤ãƒ»è¿½åŠ </li>
            <li>DOMæ§‹é€ ãŒå¤‰åŒ–</li>
            <li>ã‚„ã‚„é‡ã„</li>
          </ul>
        </div>

        <div class="method-card">
          <h3>ClientOnly</h3>
          <pre><code>&lt;ClientOnly&gt;
  &lt;p&gt;A&lt;/p&gt;
  &lt;template #fallback&gt;
    &lt;p&gt;B&lt;/p&gt;
  &lt;/template&gt;
&lt;/ClientOnly&gt;</code></pre>
          <ul>
            <li>VueãŒç‰¹åˆ¥æ‰±ã„</li>
            <li>æ˜ç¤ºçš„ã§å®‰å…¨</li>
            <li>SEO/JSã‚ªãƒ•è€ƒæ…®</li>
          </ul>
        </div>
      </div>

      <div class="recommendation-final">
        <h3>ğŸ’¡ æ¨å¥¨ã•ã‚Œã‚‹ä½¿ã„åˆ†ã‘</h3>
        <ul>
          <li><strong>åˆæœŸå€¤ãŒä¸€è‡´:</strong> ä¸‰é …æ¼”ç®—å­ã‚„v-ifã§OKï¼ˆã‚·ãƒ³ãƒ—ãƒ«ï¼‰</li>
          <li><strong>åˆæœŸå€¤ãŒç•°ãªã‚‹:</strong> ClientOnlyã‚’ä½¿ã†ï¼ˆå®‰å…¨ï¼‰</li>
          <li><strong>SEOãŒé‡è¦:</strong> ClientOnly + fallbackï¼ˆæ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³å¯¾å¿œï¼‰</li>
          <li><strong>ãƒ–ãƒ©ã‚¦ã‚¶APIä¾å­˜:</strong> ClientOnlyï¼ˆwindow, localStorageç­‰ï¼‰</li>
        </ul>
      </div>
    </div>

    <NuxtLink to="/" class="back-link">â† ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</NuxtLink>
  </div>
</template>

<style scoped>
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
}

h1 {
  color: #00dc82;
  margin-bottom: 2rem;
}

h2 {
  color: #333;
  margin-bottom: 1rem;
  font-size: 1.3rem;
}

h3 {
  color: #555;
  margin-bottom: 0.5rem;
  font-size: 1.1rem;
}

.instruction {
  background: #f0f9ff;
  border-left: 4px solid #0ea5e9;
  padding: 1.5rem;
  margin-bottom: 2rem;
  border-radius: 8px;
}

.instruction ol {
  margin-top: 1rem;
  padding-left: 1.5rem;
}

.instruction li {
  margin: 0.5rem 0;
}

.example-section {
  margin-bottom: 2rem;
}

.demo-box {
  border: 2px solid #e5e7eb;
  border-radius: 8px;
  padding: 1.5rem;
  background: white;
}

.client-content {
  background: #dbeafe;
  border: 2px solid #3b82f6;
  padding: 1rem;
  border-radius: 6px;
}

.server-content {
  background: #fef3c7;
  border: 2px solid #f59e0b;
  padding: 1rem;
  border-radius: 6px;
}

.ssr-content {
  background: #d1fae5;
  border: 2px solid #10b981;
  padding: 1rem;
  border-radius: 6px;
}

.client-content p,
.server-content p,
.ssr-content p {
  margin: 0.5rem 0;
}

code {
  background: rgba(0, 0, 0, 0.05);
  padding: 0.2rem 0.4rem;
  border-radius: 3px;
  font-family: 'Courier New', monospace;
  font-size: 0.9em;
}

.html-source {
  background: white;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  padding: 1.5rem;
  margin-bottom: 2rem;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 1rem;
}

th, td {
  padding: 0.75rem;
  text-align: left;
  border-bottom: 1px solid #e5e7eb;
}

th {
  background: #f9fafb;
  font-weight: 600;
  color: #374151;
}

tbody tr:last-child td {
  border-bottom: none;
}

.lifecycle {
  background: white;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  padding: 1.5rem;
  margin-bottom: 2rem;
}

.timeline {
  margin-top: 1.5rem;
}

.step {
  display: flex;
  gap: 1rem;
  align-items: flex-start;
  margin: 1rem 0;
}

.step-number {
  background: #00dc82;
  color: white;
  width: 2rem;
  height: 2rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  flex-shrink: 0;
}

.step-content {
  flex: 1;
  background: #f9fafb;
  padding: 1rem;
  border-radius: 6px;
}

.step-content code {
  display: block;
  margin-top: 0.5rem;
  background: #1f2937;
  color: #f9fafb;
  padding: 0.5rem;
  border-radius: 4px;
}

.arrow {
  text-align: center;
  font-size: 1.5rem;
  color: #00dc82;
  margin: 0.5rem 0;
}

.code-example {
  background: #1f2937;
  color: #f9fafb;
  padding: 1.5rem;
  border-radius: 8px;
  margin-bottom: 2rem;
}

.code-example pre {
  background: #111827;
  padding: 1rem;
  border-radius: 6px;
  overflow-x: auto;
  margin-top: 1rem;
}

.code-example code {
  background: transparent;
  color: #f9fafb;
  padding: 0;
}

.back-link {
  display: inline-block;
  color: #00dc82;
  text-decoration: none;
  font-weight: 500;
  padding: 0.75rem 1.5rem;
  border: 2px solid #00dc82;
  border-radius: 6px;
  transition: all 0.2s;
}

.back-link:hover {
  background: #00dc82;
  color: white;
}

.hydration-section {
  background: white;
  border: 2px solid #e5e7eb;
  border-radius: 8px;
  padding: 2rem;
  margin-bottom: 2rem;
}

.case-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.case-card {
  border: 2px solid;
  border-radius: 8px;
  padding: 1.5rem;
}

.case-card.safe {
  background: #d1fae5;
  border-color: #10b981;
}

.case-card.danger {
  background: #fee2e2;
  border-color: #ef4444;
}

.case-card h3 {
  margin-bottom: 1rem;
}

.case-card pre {
  margin: 1rem 0;
}

.explanation {
  margin-top: 1rem;
  padding: 0.75rem;
  background: rgba(255, 255, 255, 0.5);
  border-radius: 6px;
  font-size: 0.9rem;
}

.comparison-box {
  margin-top: 2rem;
}

.comparison-box table {
  margin-top: 1rem;
}

.safe-row {
  background: #f0fdf4;
}

.danger-row {
  background: #fef2f2;
}

.vif-section {
  background: white;
  border: 2px solid #e5e7eb;
  border-radius: 8px;
  padding: 2rem;
  margin-bottom: 2rem;
}

.method-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.method-card {
  border: 2px solid #e5e7eb;
  border-radius: 8px;
  padding: 1.5rem;
  background: #f9fafb;
}

.method-card h3 {
  color: #00dc82;
  margin-bottom: 1rem;
}

.method-card pre {
  margin: 1rem 0;
  background: #1f2937;
}

.method-card ul {
  margin: 0;
  padding-left: 1.5rem;
  font-size: 0.9rem;
}

.method-card li {
  margin: 0.4rem 0;
}

.recommendation-final {
  background: #f0f9ff;
  border-left: 4px solid #0ea5e9;
  border-radius: 8px;
  padding: 1.5rem;
  margin-top: 2rem;
}

.recommendation-final h3 {
  color: #0c4a6e;
  margin-bottom: 1rem;
}

.recommendation-final ul {
  margin: 0;
  padding-left: 1.5rem;
}

.recommendation-final li {
  margin: 0.75rem 0;
  line-height: 1.6;
}
</style>
